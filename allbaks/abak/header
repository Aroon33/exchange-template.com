document.addEventListener("DOMContentLoaded", () => {

  /* =========================
     Header
  ========================= */
  const header = document.createElement("header");
  header.className = "admin-header";
  header.innerHTML = `
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div class="admin-logo-text">Admin</div>
    </div>
    <div class="admin-header-right">
      <button class="sidebar-toggle" aria-label="menu">â˜°</button>
    </div>
  `;
  document.body.prepend(header);

  /* =========================
     Sidebarï¼ˆâ€» å…¥ã‚Œå­ãªã—ï¼‰
  ========================= */
  const sidebar = document.createElement("aside");
  sidebar.className = "sidebar";
  sidebar.innerHTML = `
    <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul class="nav-list">
    <li class="nav-item"><a href="index.html" class="nav-link">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
    <li class="nav-item"><a href="tickets.html" class="nav-link">ğŸ’¬ å•ã„åˆã‚ã›ç®¡ç†</a></li>
    <li class="nav-item"><a href="users.html" class="nav-link">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a></li>
    <li class="nav-item"><a href="trades.html" class="nav-link">ğŸ“Š å–å¼•çŠ¶æ³</a></li>
    <li class="nav-item"><a href="kyc.html" class="nav-link">ğŸ“‹ KYCçŠ¶æ³</a></li>
    <li class="nav-item"><a href="deposit.html" class="nav-link">â• å…¥é‡‘ç”³è«‹</a></li>
    <li class="nav-item"><a href="withdraw.html" class="nav-link">â– å‡ºé‡‘ç”³è«‹</a></li>
    <li class="nav-item"><a href="group.html" class="nav-link">ğŸ§© ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</a></li>
    <li class="nav-item"><a href="settings.html" class="nav-link">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</a></li>
    <li class="nav-item"><a href="system-positions.html" class="nav-link">ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³</a></li>
    <li class="nav-item"><a href="system-history.html" class="nav-link">ğŸ“œ ã‚·ã‚¹ãƒ†ãƒ å±¥æ­´</a></li>
    <li class="nav-item"><a href="deposit-bank-accounts.html" class="nav-link">ğŸ“œ éŠ€è¡Œç®¡ç†</a></li>
    <li class="nav-item"><a href="deposit-bank-account-edit.html" class="nav-link">ğŸ“œ å£åº§ç™»éŒ²</a></li>
    <li class="nav-item"><a href="deposit-crypto-address-edit.html" class="nav-link">ğŸ“œ ã‚¢ãƒ‰ãƒ¬ã‚¹ç™»éŒ²</a></li>
    </ul>
  `;
  document.body.prepend(sidebar);

  /* =========================
     Overlay
  ========================= */
  const overlay = document.createElement("div");
  overlay.className = "sidebar-overlay";
  document.body.appendChild(overlay);

  /* =========================
     åˆæœŸçŠ¶æ…‹ï¼šå¿…ãšé–‰ã˜ã‚‹
  ========================= */
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
  document.body.classList.remove("sidebar-open");

  /* =========================
     é–‹é–‰åˆ¶å¾¡
  ========================= */
  const toggleBtn = header.querySelector(".sidebar-toggle");

  toggleBtn.addEventListener("click", () => {
    sidebar.classList.toggle("open");
    overlay.classList.toggle("show");
    document.body.classList.toggle("sidebar-open");
  });

  function closeSidebar() {
    sidebar.classList.remove("open");
    overlay.classList.remove("show");
    document.body.classList.remove("sidebar-open");
  }

  overlay.addEventListener("click", closeSidebar);

  sidebar.addEventListener("click", e => {
    if (e.target.closest(".nav-link") && window.innerWidth <= 768) {
      closeSidebar();
    }
  });

  document.addEventListener("keydown", e => {
    if (e.key === "Escape") closeSidebar();
  });

  /* =========================
     Active link
  ========================= */
  const current = location.pathname.split("/").pop();
  sidebar.querySelectorAll(".nav-link").forEach(a => {
    if (a.getAttribute("href") === current) {
      a.classList.add("active");
    }
  });
});
