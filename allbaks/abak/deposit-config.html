<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - 入金先設定</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

   <!-- CSS -->
  <link rel="stylesheet" href="/admin/assets/css/style.css" />
  <link rel="stylesheet" href="/admin/assets/css/admin.css" />
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-title">メニュー</div>
  <ul class="nav-list">
    <li class="nav-item"><a href="deposit.html" class="nav-link">← 入金申請へ戻る</a></li>
  </ul>
</aside>

<!-- HEADER -->
<header class="admin-header">
  <div class="admin-header-left">
    <div class="admin-logo-badge">AX</div>
    <div>
      <div class="admin-logo-text">Admin Console</div>
      <div class="admin-logo-sub">入金先設定</div>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="admin-main">
  <div class="admin-main-inner" style="max-width:720px;">

    <div class="page-title">入金先情報の編集</div>

    <div class="card">

      <h3>日本円（銀行口座）</h3>

      <div class="form-row">
        <label>銀行名</label>
        <input id="bank_name" />
      </div>

      <div class="form-row">
        <label>支店名</label>
        <input id="bank_branch" />
      </div>

      <div class="form-row">
        <label>口座種別</label>
        <input id="bank_account_type" />
      </div>

      <div class="form-row">
        <label>口座番号</label>
        <input id="bank_account_number" />
      </div>

      <div class="form-row">
        <label>口座名義</label>
        <input id="bank_account_name" />
      </div>

      <hr>

      <h3>暗号通貨</h3>

      <div class="form-row">
        <label>BTC アドレス</label>
        <input id="btc_address" />
      </div>

      <div class="form-row">
        <label>ETH アドレス</label>
        <input id="eth_address" />
      </div>

      <hr>

      <h3>注意文言</h3>

      <div class="form-row">
        <textarea id="deposit_note" rows="4"></textarea>
      </div>

      <div style="margin-top:16px;">
        <button class="btn btn-primary" onclick="save()">保存</button>
        <button class="btn btn-outline" onclick="location.href='deposit.html'">戻る</button>
      </div>

    </div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
const API_BASE = "https://api.exchange-template.com";

/* -------------------------
   Utility
------------------------- */
function toast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"), 2000);
}

/* -------------------------
   Load current config
------------------------- */
async function load() {
  const res = await fetch(API_BASE + "/deposit/config", { credentials:"include" });
  const data = await res.json();

  bank_name.value = data.bank.name;
  bank_branch.value = data.bank.branch;
  bank_account_type.value = data.bank.type;
  bank_account_number.value = data.bank.number;
  bank_account_name.value = data.bank.holder;

  btc_address.value = data.crypto.BTC;
  eth_address.value = data.crypto.ETH;

  deposit_note.value = data.note;
}

/* -------------------------
   Save
------------------------- */
async function save() {
  const body = {
    bank_name: bank_name.value,
    bank_branch: bank_branch.value,
    bank_account_type: bank_account_type.value,
    bank_account_number: bank_account_number.value,
    bank_account_name: bank_account_name.value,
    btc_address: btc_address.value,
    eth_address: eth_address.value,
    deposit_note: deposit_note.value,
  };

  const res = await fetch(API_BASE + "/admin/deposit/config", {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(body),
  });

  if (!res.ok) {
    toast("保存に失敗しました");
    return;
  }

  toast("保存しました");
}

load();
</script>

<script src="/admin/assets/js/admin-auth.js"></script>
<script src="/admin/assets/js/header-admin.js"></script>

</body>
</html>
