<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>

  <!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
  <ul class="nav-list">
    <li class="nav-item"><a href="index.html" class="nav-link">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
    <li class="nav-item"><a href="tickets.html" class="nav-link">ğŸ’¬ å•ã„åˆã‚ã›ç®¡ç†</a></li>
    <li class="nav-item"><a href="users.html" class="nav-link">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a></li>
    <li class="nav-item"><a href="trades.html" class="nav-link">ğŸ“Š å–å¼•çŠ¶æ³</a></li>
    <li class="nav-item"><a href="kyc.html" class="nav-link">ğŸ“‹ KYCçŠ¶æ³</a></li>
    <li class="nav-item"><a href="deposit.html" class="nav-link">â• å…¥é‡‘ç”³è«‹</a></li>
    <li class="nav-item"><a href="withdraw.html" class="nav-link">â– å‡ºé‡‘ç”³è«‹</a></li>
    <li class="nav-item"><a href="group.html" class="nav-link">ğŸ§© ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</a></li>
    <li class="nav-item"><a href="settings.html" class="nav-link">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</a></li>
    <li class="nav-item"><a href="system-positions.html" class="nav-link">ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³</a></li>
    <li class="nav-item"><a href="system-history.html" class="nav-link active">ğŸ“œ ã‚·ã‚¹ãƒ†ãƒ å±¥æ­´</a></li>
  </ul>
</aside>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div>
        <div class="admin-logo-text">Admin Console</div>
        <div class="admin-logo-sub">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</div>
      </div>
    </div>
    <div class="admin-header-right">
      <button class="btn btn-outline btn-sm" onclick="location.href='../login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ -->
  <main class="admin-main">
    <div class="admin-main-inner">

      <div class="page-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <section class="filters-card">
        <div class="filters-grid">
          
          <div class="field">
            <label>ã‚°ãƒ«ãƒ¼ãƒ—ID</label>
            <select id="f-group">
              <option value="">ã™ã¹ã¦</option>
              <option value="1">1</option>
              <option value="2">2</option>
            </select>
          </div>

          <div class="field">
            <label>é–‹è¨­æ—¥ From</label>
            <input type="date" id="f-from" />
          </div>

          <div class="field">
            <label>é–‹è¨­æ—¥ To</label>
            <input type="date" id="f-to" />
          </div>

          <div class="field">
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰/ãƒ¡ãƒ¼ãƒ«ï¼‰</label>
            <input type="text" id="f-text" placeholder="ä¾‹ï¼šå±±ç”° / test@example.com" />
          </div>

        </div>

        <div class="filter-actions">
          <button class="btn-xs" id="btn-clear">ã‚¯ãƒªã‚¢</button>
          <button class="btn-xs btn-xs-primary" id="btn-search">æ¤œç´¢</button>
        </div>
      </section>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <section class="table-card">
        <div class="table-header-row">
          <div class="table-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</div>
          <div class="table-meta" id="table-meta">0ä»¶</div>
        </div>

        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>åå‰</th>
              <th>ãƒ¡ãƒ¼ãƒ«</th>
              <th>ã‚°ãƒ«ãƒ¼ãƒ—</th>
              <th>é–‹è¨­æ—¥</th>
              <th>æ®‹é«˜</th>
              <th>è©³ç´°</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </section>

    </div>
  </main>

  <!-- JSï¼ˆå¾Œã§é€ã‚Šã¾ã™ï¼‰ -->
  <script>
const API_BASE = "https://api.exchange-template.com";

/* â–¼ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ */
async function doLogout() {
  await fetch(API_BASE + "/auth/logout", {
    method: "POST",
    credentials: "include",
  });
  window.location.href = "../login.html";
}

/* â–¼ API GET */
async function apiGet(path) {
  const res = await fetch(API_BASE + path, { credentials: "include" });
  if (res.status === 401) doLogout();
  const txt = await res.text();
  if (!res.ok) throw new Error(txt);
  return JSON.parse(txt);
}

/* â–¼ DOM */
const tbody      = document.getElementById("table-body");   // â† ä¿®æ­£æ¸ˆã¿
const fGroup     = document.getElementById("f-group");
const fFrom      = document.getElementById("f-from");
const fTo        = document.getElementById("f-to");
const fText      = document.getElementById("f-text");
const metaEl     = document.getElementById("table-meta");

let allUsers = [];

/* â–¼ æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ */
function fmtDate(iso) {
  if (!iso) return "-";
  return new Date(iso).toLocaleDateString("ja-JP");
}

/* â–¼ å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼èª­ã¿è¾¼ã¿ */
async function loadUsers() {
  allUsers = await apiGet("/admin/users");
  renderTable(allUsers); // åˆæœŸè¡¨ç¤ºã¯å…¨ä»¶
}

/* â–¼ ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ */
function applyFilters() {
  let list = [...allUsers];

  const group = Number(fGroup.value);
  const from  = fFrom.value ? new Date(fFrom.value) : null;
  const to    = fTo.value ? new Date(fTo.value) : null;
  const text  = fText.value.trim().toLowerCase();

  // ã‚°ãƒ«ãƒ¼ãƒ—
  if (group > 0) list = list.filter(u => Number(u.groupId) === group);

  // é–‹è¨­æ—¥ãƒ•ã‚£ãƒ«ã‚¿
  if (from) list = list.filter(u => new Date(u.createdAt) >= from);
  if (to)   list = list.filter(u => new Date(u.createdAt) <= to);

  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰ / ãƒ¡ãƒ¼ãƒ«ï¼‰
  if (text) {
    list = list.filter(u =>
      u.name.toLowerCase().includes(text) ||
      u.email.toLowerCase().includes(text)
    );
  }

  renderTable(list);
}

/* â–¼ ãƒ†ãƒ¼ãƒ–ãƒ«æç”» */
function renderTable(list) {
  tbody.innerHTML = "";
  metaEl.textContent = `${list.length}ä»¶`;

  if (!list.length) {
    tbody.innerHTML = `<tr><td colspan="7" class="muted">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>`;
    return;
  }

  list.forEach(u => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.id}</td>
      <td>${u.name}</td>
      <td>${u.email}</td>
      <td>${u.groupId ?? "-"}</td>
      <td>${fmtDate(u.createdAt)}</td>
      <td>${u.balanceTotal ?? 0}</td>
      <td><a href="user_detail.html?id=${u.id}" class="btn-xs btn-primary">è©³ç´°</a></td>
    `;
    tbody.appendChild(tr);
  });
}

/* â–¼ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ */
document.getElementById("btn-search").addEventListener("click", applyFilters);
document.getElementById("btn-clear").addEventListener("click", () => {
  fGroup.value = "";
  fFrom.value = "";
  fTo.value = "";
  fText.value = "";
  renderTable(allUsers);
});

/* â–¼ åˆæœŸãƒ­ãƒ¼ãƒ‰ */
loadUsers().catch(console.error);
</script>



</body>
</html>
