<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - å…¥é‡‘ç”³è«‹ç®¡ç†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>

  <!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
  <ul class="nav-list">
    <li class="nav-item"><a href="index.html" class="nav-link">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
    <li class="nav-item"><a href="tickets.html" class="nav-link">ğŸ’¬ å•ã„åˆã‚ã›ç®¡ç†</a></li>
    <li class="nav-item"><a href="users.html" class="nav-link">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a></li>
    <li class="nav-item"><a href="trades.html" class="nav-link">ğŸ“Š å–å¼•çŠ¶æ³</a></li>
    <li class="nav-item"><a href="kyc.html" class="nav-link">ğŸ“‹ KYCçŠ¶æ³</a></li>
    <li class="nav-item"><a href="deposit.html" class="nav-link">â• å…¥é‡‘ç”³è«‹</a></li>
    <li class="nav-item"><a href="withdraw.html" class="nav-link">â– å‡ºé‡‘ç”³è«‹</a></li>
    <li class="nav-item"><a href="group.html" class="nav-link">ğŸ§© ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</a></li>
    <li class="nav-item"><a href="settings.html" class="nav-link">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</a></li>
    <li class="nav-item"><a href="system-positions.html" class="nav-link">ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³</a></li>
    <li class="nav-item"><a href="system-history.html" class="nav-link active">ğŸ“œ ã‚·ã‚¹ãƒ†ãƒ å±¥æ­´</a></li>
  </ul>
</aside>


  <!-- HEADER -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div>
        <div class="admin-logo-text">Admin Console</div>
        <div class="admin-logo-sub">å…¥é‡‘ç”³è«‹ç®¡ç†</div>
      </div>
    </div>
    <div class="admin-header-right">
      <span id="admin-user-label">ç®¡ç†è€…</span>
      <button class="btn btn-outline btn-sm" onclick="location.href='../login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </header>

  <!-- MAIN -->
  <main class="admin-main">
    <div class="admin-main-inner">

      <div class="page-title">å…¥é‡‘ç”³è«‹ä¸€è¦§ï¼ˆPENDINGï¼‰</div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <div style="margin:12px 0;">
        <select id="status-filter" class="btn-sm">
          <option value="ALL">ã™ã¹ã¦</option>
          <option value="PENDING">ç”³è«‹ä¸­</option>
          <option value="COMPLETED">å®Œäº†</option>
          <option value="CANCELED">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</option>
        </select>
        <button class="btn-sm" id="reload-btn">å†èª­ã¿è¾¼ã¿</button>
      </div>

      <!-- TABLE -->
      <div class="card" style="margin-top:16px;">
        <table class="table" style="width:100%; font-size:13px;">
          <thead>
            <tr>
              <th>ID</th>
              <th>ç”³è«‹æ—¥æ™‚</th>
              <th>åå‰</th>
              <th>method</th>
              <th>currency</th>
              <th>é‡‘é¡</th>
              <th>æ›´æ–°æ—¥æ™‚</th>
              <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="deposit-table-body">
            <tr><td colspan="9" style="text-align:center;color:#777;">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
          </tbody>
        </table>
      </div>

    </div>
  </main>

  <div class="toast" id="toast"></div>

  <!-- SCRIPT -->
  <script>
    const API_BASE = "https://api.exchange-template.com";

    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 2000);
    }

    function formatDate(iso) {
      if (!iso) return "-";
      return new Date(iso).toLocaleString("ja-JP", { hour12:false });
    }

    function formatAmount(a) {
      const num = Number(a);
      if (isNaN(num)) return a;
      return num.toLocaleString("en-US", { minimumFractionDigits:2, maximumFractionDigits:8 });
    }

    // GET wrapper
    async function apiGet(path) {
      const res = await fetch(API_BASE + path, {
        credentials: "include",
      });
      const txt = await res.text();
      if (!res.ok) throw new Error(txt);
      return JSON.parse(txt);
    }

    // POST wrapper
    async function apiPost(path, body) {
      const res = await fetch(API_BASE + path, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const txt = await res.text();
      if (!res.ok) throw new Error(txt);
      return JSON.parse(txt);
    }

    // æ‰¿èªå‡¦ç†
    async function approveDeposit(id) {
      try {
        await apiPost("/deposit/approve", { id });
        showToast("æ‰¿èªã—ã¾ã—ãŸ");
        loadDeposits();
      } catch (e) {
        console.error(e);
        showToast("æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    }

    // æç”»
    function renderTable(list) {
      const tbody = document.getElementById("deposit-table-body");
      tbody.innerHTML = "";

      if (!list.length) {
        tbody.innerHTML =
          '<tr><td colspan="9" style="text-align:center;color:#777;">ç”³è«‹ãªã—</td></tr>';
        return;
      }

      list.forEach(t => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${t.id}</td>
          <td>${formatDate(t.createdAt)}</td>
          <td>${t.user?.name ?? "-"}</td>
          <td>${t.method ?? "-"}</td>
          <td>${t.currency ?? "-"}</td>
          <td>${formatAmount(t.amount)}</td>
          <td>${formatDate(t.updatedAt)}</td>
          <td>${t.status}</td>
          <td>
            <button class="btn-xs btn-xs-primary" onclick="approveDeposit(${t.id})">
              æ‰¿èª
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function loadDeposits() {
      try {
        const list = await apiGet("/deposit/pending");
        renderTable(list);
      } catch (e) {
        console.error(e);
        showToast("å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    }

    // åˆæœŸåŒ–
    loadDeposits();
  </script>

</body>
</html>
